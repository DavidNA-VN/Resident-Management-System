import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useState, useEffect } from "react";
const requestTypeLabels = {
    TAM_VANG: "Xin tạm vắng",
    TAM_TRU: "Xin tạm trú",
    TACH_HO_KHAU: "Yêu cầu tách hộ khẩu",
    SUA_NHAN_KHAU: "Sửa thông tin nhân khẩu",
    XOA_NHAN_KHAU: "Xoá nhân khẩu",
};
export default function RequestModal({ isOpen, type, onClose, onSubmit, nhanKhauList = [], householdInfo, }) {
    const [formData, setFormData] = useState({});
    const [isSubmitting, setIsSubmitting] = useState(false);
    const [error, setError] = useState(null);
    useEffect(() => {
        if (isOpen && type) {
            // Reset form khi mở modal
            setFormData({});
            setError(null);
        }
    }, [isOpen, type]);
    const handleSubmit = async (e) => {
        e.preventDefault();
        setError(null);
        // Validate
        if (type === "TAM_VANG" || type === "TAM_TRU" || type === "SUA_NHAN_KHAU" || type === "XOA_NHAN_KHAU") {
            if (!formData.nhanKhauId) {
                setError("Vui lòng chọn nhân khẩu");
                return;
            }
        }
        if (type === "TAM_VANG" || type === "TAM_TRU") {
            if (!formData.tuNgay) {
                setError("Vui lòng chọn từ ngày");
                return;
            }
        }
        if (type === "TAM_VANG" || type === "TAM_TRU" || type === "SUA_NHAN_KHAU" || type === "XOA_NHAN_KHAU") {
            if (!formData.lyDo || formData.lyDo.trim() === "") {
                setError("Vui lòng nhập lý do");
                return;
            }
        }
        setIsSubmitting(true);
        try {
            await onSubmit({
                type,
                payload: formData,
            });
            // Reset form sau khi submit thành công
            setFormData({});
            onClose();
        }
        catch (err) {
            setError(err.error?.message || "Có lỗi xảy ra khi gửi yêu cầu");
        }
        finally {
            setIsSubmitting(false);
        }
    };
    if (!isOpen || !type)
        return null;
    return (_jsx("div", { className: "fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4", onClick: onClose, children: _jsxs("div", { className: "w-full max-w-2xl rounded-2xl border border-gray-200 bg-white p-6 shadow-xl", onClick: (e) => e.stopPropagation(), children: [_jsxs("div", { className: "mb-6 flex items-center justify-between border-b border-gray-200 pb-4", children: [_jsx("h2", { className: "text-2xl font-bold text-gray-900", children: requestTypeLabels[type] }), _jsx("button", { onClick: onClose, className: "rounded-lg p-2 text-gray-400 hover:bg-gray-100 hover:text-gray-600 transition-colors", children: "\u2715" })] }), error && (_jsx("div", { className: "mb-4 rounded-lg bg-red-50 border border-red-200 p-3 text-sm text-red-700", children: error })), _jsxs("form", { onSubmit: handleSubmit, className: "space-y-4", children: [type === "TAM_VANG" && (_jsxs(_Fragment, { children: [_jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["Ch\u1ECDn nh\u00E2n kh\u1EA9u ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsxs("select", { value: formData.nhanKhauId || "", onChange: (e) => setFormData({ ...formData, nhanKhauId: Number(e.target.value) }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", required: true, children: [_jsx("option", { value: "", children: "-- Ch\u1ECDn nh\u00E2n kh\u1EA9u --" }), nhanKhauList.map((nk) => (_jsx("option", { value: nk.id, children: nk.hoTen }, nk.id)))] })] }), _jsxs("div", { className: "grid grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["T\u1EEB ng\u00E0y ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsx("input", { type: "date", value: formData.tuNgay || "", onChange: (e) => setFormData({ ...formData, tuNgay: e.target.value }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", required: true })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: "\u0110\u1EBFn ng\u00E0y" }), _jsx("input", { type: "date", value: formData.denNgay || "", onChange: (e) => setFormData({ ...formData, denNgay: e.target.value }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20" })] })] }), _jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["L\u00FD do ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsx("textarea", { value: formData.lyDo || "", onChange: (e) => setFormData({ ...formData, lyDo: e.target.value }), rows: 4, className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", placeholder: "Nh\u1EADp l\u00FD do t\u1EA1m v\u1EAFng...", required: true })] })] })), type === "TAM_TRU" && (_jsxs(_Fragment, { children: [_jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["Ch\u1ECDn nh\u00E2n kh\u1EA9u ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsxs("select", { value: formData.nhanKhauId || "", onChange: (e) => setFormData({ ...formData, nhanKhauId: Number(e.target.value) }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", required: true, children: [_jsx("option", { value: "", children: "-- Ch\u1ECDn nh\u00E2n kh\u1EA9u --" }), nhanKhauList.map((nk) => (_jsx("option", { value: nk.id, children: nk.hoTen }, nk.id)))] })] }), _jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["\u0110\u1ECBa ch\u1EC9 t\u1EA1m tr\u00FA ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsx("input", { type: "text", value: formData.diaChi || "", onChange: (e) => setFormData({ ...formData, diaChi: e.target.value }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", placeholder: "Nh\u1EADp \u0111\u1ECBa ch\u1EC9 t\u1EA1m tr\u00FA...", required: true })] }), _jsxs("div", { className: "grid grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["T\u1EEB ng\u00E0y ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsx("input", { type: "date", value: formData.tuNgay || "", onChange: (e) => setFormData({ ...formData, tuNgay: e.target.value }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", required: true })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: "\u0110\u1EBFn ng\u00E0y" }), _jsx("input", { type: "date", value: formData.denNgay || "", onChange: (e) => setFormData({ ...formData, denNgay: e.target.value }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20" })] })] }), _jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["Ghi ch\u00FA/L\u00FD do ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsx("textarea", { value: formData.lyDo || "", onChange: (e) => setFormData({ ...formData, lyDo: e.target.value }), rows: 4, className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", placeholder: "Nh\u1EADp l\u00FD do t\u1EA1m tr\u00FA...", required: true })] })] })), type === "SUA_NHAN_KHAU" && (_jsxs(_Fragment, { children: [_jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["Ch\u1ECDn nh\u00E2n kh\u1EA9u c\u1EA7n s\u1EEDa ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsxs("select", { value: formData.nhanKhauId || "", onChange: (e) => setFormData({ ...formData, nhanKhauId: Number(e.target.value) }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", required: true, children: [_jsx("option", { value: "", children: "-- Ch\u1ECDn nh\u00E2n kh\u1EA9u --" }), nhanKhauList.map((nk) => (_jsx("option", { value: nk.id, children: nk.hoTen }, nk.id)))] })] }), _jsxs("div", { className: "grid grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: "H\u1ECD t\u00EAn m\u1EDBi" }), _jsx("input", { type: "text", value: formData.hoTen || "", onChange: (e) => setFormData({ ...formData, hoTen: e.target.value }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", placeholder: "Nh\u1EADp h\u1ECD t\u00EAn m\u1EDBi..." })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: "CCCD/CMND m\u1EDBi" }), _jsx("input", { type: "text", value: formData.cccd || "", onChange: (e) => setFormData({ ...formData, cccd: e.target.value }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", placeholder: "Nh\u1EADp CCCD/CMND m\u1EDBi..." })] })] }), _jsxs("div", { className: "grid grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: "Ng\u00E0y sinh m\u1EDBi" }), _jsx("input", { type: "date", value: formData.ngaySinh || "", onChange: (e) => setFormData({ ...formData, ngaySinh: e.target.value }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20" })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: "Gi\u1EDBi t\u00EDnh m\u1EDBi" }), _jsxs("select", { value: formData.gioiTinh || "", onChange: (e) => setFormData({ ...formData, gioiTinh: e.target.value }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", children: [_jsx("option", { value: "", children: "-- Ch\u1ECDn gi\u1EDBi t\u00EDnh --" }), _jsx("option", { value: "nam", children: "Nam" }), _jsx("option", { value: "nu", children: "N\u1EEF" }), _jsx("option", { value: "khac", children: "Kh\u00E1c" })] })] })] }), _jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["L\u00FD do s\u1EEDa ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsx("textarea", { value: formData.lyDo || "", onChange: (e) => setFormData({ ...formData, lyDo: e.target.value }), rows: 4, className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", placeholder: "Nh\u1EADp l\u00FD do s\u1EEDa th\u00F4ng tin...", required: true })] })] })), type === "XOA_NHAN_KHAU" && (_jsxs(_Fragment, { children: [_jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["Ch\u1ECDn nh\u00E2n kh\u1EA9u c\u1EA7n xo\u00E1 ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsxs("select", { value: formData.nhanKhauId || "", onChange: (e) => setFormData({ ...formData, nhanKhauId: Number(e.target.value) }), className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", required: true, children: [_jsx("option", { value: "", children: "-- Ch\u1ECDn nh\u00E2n kh\u1EA9u --" }), nhanKhauList.map((nk) => (_jsx("option", { value: nk.id, children: nk.hoTen }, nk.id)))] })] }), _jsxs("div", { children: [_jsxs("label", { className: "block text-sm font-medium text-gray-700 mb-2", children: ["L\u00FD do xo\u00E1 ", _jsx("span", { className: "text-red-500", children: "*" })] }), _jsx("textarea", { value: formData.lyDo || "", onChange: (e) => setFormData({ ...formData, lyDo: e.target.value }), rows: 4, className: "w-full rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20", placeholder: "Nh\u1EADp l\u00FD do xo\u00E1 nh\u00E2n kh\u1EA9u...", required: true })] })] })), _jsxs("div", { className: "flex gap-3 pt-4 border-t border-gray-200", children: [_jsx("button", { type: "button", onClick: onClose, className: "flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2.5 text-sm font-medium text-gray-700 hover:bg-gray-50 transition-colors", disabled: isSubmitting, children: "Hu\u1EF7" }), _jsx("button", { type: "submit", className: "flex-1 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-500 px-4 py-2.5 text-sm font-medium text-white shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed", disabled: isSubmitting, children: isSubmitting ? "Đang gửi..." : "Gửi yêu cầu" })] })] })] }) }));
}
